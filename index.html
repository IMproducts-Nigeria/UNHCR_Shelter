<!DOCTYPE html>
<!-- Sector Dashboard -->
<html lang="en">
    <head>
        <title>Shelter Response | L3 Operation in Nigeria</title>
        <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
        <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" name="viewport" />
        <meta content="UNHCR Information management" name="author" />
        <meta content="UNHCR Maiduguri in Nigeria" property="og:title" />
        <meta content="article" property="og:type" />
        <meta content="http://data.unhcr.org/jordan/response/Protection" property="og:url" />
        <meta content="http://data.unhcr.org/jordan/images/Protectiondashboard.jpg" property="og:image" />
        <meta content="UNHCR Maidguri in Nigeria" property="og:site_name" />
        <meta content="UNHCR Maiduguri in Nigeria" property="og:description" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        
        <!-- Bootstrap with Yeti them from bootswatch-->
        <link rel="stylesheet" href="css/bootstrap.min.css" media="screen">
        <link rel="stylesheet" href="css/bootswatch.min.css" type="text/css" >
        <link rel="stylesheet" href="css/font-humanitarian.css" type="text/css" >
        <link rel="stylesheet" href="css/dc.css" type="text/css" />
        <link href="css/dashboard.css" rel="stylesheet" type="text/css" />
        
        
        <!-- Add IntroJs styles and JS -->
        <link href="css/introjs.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="js/intro.js"></script>
        <script type="text/javascript" src="js/monthlyReport.js"> </script>
        <script src="js/jquery.js"></script>
        <!-- map the data to the GeoJSON object -->
        <script src="js/data-jo.js"></script>
        <link href="http://www.unhcr.org/favicon.ico" rel="icon" type="image/x-icon">

        <!-- HTML5 shim, for IE6-8 support of HTML elements--><!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    </head>
    <body>
     <!-- Loading screen -->
        <div class="loader"></div>
        <div class="container-fluid" id="dashboard">

                <!--    Color code for dashboard
                        '#c00000', /* Education */
                        '#006600', /* Food Security */
                        '#7f7f7f', /* NFI */
                        '#376092', /* Protection */
                        '#92d050', /* Public Health */
                        '#215968', /* SCL*/
                        '#ffc000', /* Shelter */
                        '#7030a0', /* WASH */

                        Revised Color code for dashboard 2016
                        '#d44e5b', /* Education */
                        '#00b26b', /* Food Security */
                        '#58595b', /* basic needs */
                        '#33a3dc', /* Protection */
                        '#9ecf7c', /* Health */
                        '#febd3b', /* Shelter */
                        '#766aab', /* WASH */
                -->

            <div class="row" style="background-color: #33a3dc; color: #ffffff">
                <div class="col-md-1">
                    <left >
                        <i class="icon-orga-unhcr" style="color:white; font-size:100px;" ></i>
                    </left>
                </div>
                <div class="col-md-7">
                   <!-- <center> </center> -->
                        <h3><strong>Shelter Response | L3 Operation in Nigeria
                         | <a href="index.html"  target="_blank"><i class="icon-im-coord" style="color:white; font-size:20px;" ></i></a></strong></h3>
                        The data presented here are collected through the <a href="https://www.syrianrefugeeresponse.org/" target="_blank">Syrian Refugee Response</a> platform and then cleared by Sector focal points.
                        You can donwload the <a href="data.csv" target="_blank">data here</a>. More info on jordan <a href="http://data.unhcr.org/jordan" target="_blank">here</a>.<br />
                        <strong>The following charts shows the achievement of the Shelter sector. Click on any of the graphs below to filter and slice the data.</strong>
                        <p>The units displayed here corresponds to "Assistance Instance". As such totals presented here should be analysed with caution. </p>
                </div>
                <div class="col-md-4">
                    <div class="row" >
                        <div class="socialmedia" data-step="11" data-intro="Feel Free to share if you like it!" data-position="left">
                            <table width = "100%">
                              <tbody>
                                  <tr>
                                    <td valign="middle"><a href="http://www.facebook.com/sharer.php?u=http://data.unhcr.org/jordan/sectors/shelter" target="_blank">
                                        <img src="img/Facebook.png" style="height: 25px; width: 25px"></a></td>
                                    <td valign="middle"><a href="https://twitter.com/intent/tweet?url=http://data.unhcr.org/jordan/sectors/shelter&amp;text=%23jordan%20@Refugees" target="_blank">
                                        <img src="img/Twitter.png" style="height: 25px; width: 25px"></a></td>
                                    <td valign="middle"><a href="https://plus.google.com/share?&amp;hl=en&amp;url=http://data.unhcr.org/jordan/sectors/shelter" target="_blank">
                                        <img src="img/Google.png" style="height: 25px; width: 25px"></a></td>
                                  </tr>
                            </tbody></table><br>
                        </div>
                    </div>
                    <div class="row" >
                        <p><b>Leading Agencies:</b> <i>UNHCR</i> <a href="mailto:dupin@unhcr.org">Vincent Dupin</a> &
                        <i>NRC<i> <a href="mailto:annika.hampson@nrc.no">Annika Hampson</a></b></p>
                        <br>
                        <div class="dc-chart" id="count-info" data-step="12" data-intro="Click on this button to clear all the filters." data-position="right">
                        <strong><span class="filter-count " ></span></strong> selected out of <span class="total-count "></span> records</div>&nbsp;&nbsp;
                        <a class="reset btn btn-primary btn-sm" id="reset" href="javascript:dc.filterAll();dc.redrawAll();">Reset All Filters</a>&nbsp;&nbsp;
                        <a class="btn btn btn-success" href="javascript:void(0);" onclick="javascript:introJs().start();">Tutorial</a> <br >
                       
                    </div>
                </div>
            </div>
           
            <div class="row" >
                <div class="tab-pane fade active in" id="Overview">
                    <div class="row">
                                   <div class="col-md-4">

                <div class="row">
                    <div id="sector" class="col-xs-12 col-md-8 dc-chart" data-step="2" data-intro="Click on this row chart chart to filter by sector." data-position="right">
                        <h5><strong>By Sectors / Working Groups</strong></h5>
                    </div>
                </div>
                <div style="position:relative;top:180;left:20px; width:700px">
				<strong>
				<BR>
				UNHCR & IOM thank all partners for their data and cooperation.
				<BR>
				Produced by the Regional Bureau for Europe, UNHCR, Geneva, with support from the UNHCR Jordan team.
				</strong>

               </div>

            </div>


            <div class="col-md-4">
                <div class="row">
                    <div id="map2" class="col-xs-12 col-md-8 dc-chart" data-step="4" data-intro="Or click on this map to filter by area of operation." data-position="right">
                        <h5><strong>Filter on the Map </strong><small>by Country</small></h5>

                    </div>
                </div>
                <div class="row">
				<br>
                    <div id="area" class="col-xs-12 col-md-8 dc-chart" data-step="5" data-intro="Click on this row chart to filter by area of operation." data-position="right">
                        <h5><strong>Top Countries </strong><small>by Country</small></h5>

                    </div>

                </div>
            </div>


        <script type="text/javascript" src="js/d3_002.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript" src="js/d3.js"></script>

 <script>


        var sector_chart = dc.rowChart("#sector");
        var org_chart = dc.rowChart("#orgs");
        var area_chart = dc.rowChart("#area");


        var map2_chart = dc.geoChoroplethChart("#map2");

        d3.csv("data/rrmrpviz.csv", function(csv_data){

            var numberFormat = d3.format(",f");
           // si = d3.format('s');
           // siMod = function(val) { return si(val).replace(/G/, 'B') };

            var cf = crossfilter(csv_data);

            cf.agency = cf.dimension(function(d) { return d.Agency; });
            cf.sector = cf.dimension(function(d) { return d.Sector; });
            cf.area = cf.dimension(function(d) { return d.Country; });
            cf.ccode = cf.dimension(function(d) { return d.Ccode; });
            cf.total = cf.dimension(function(d) { return d.Total; });




            var agency = cf.agency.group();
            var sector = cf.sector.group();
            var area = cf.area.group();
            var ccode = cf.ccode.group();
            var all = cf.groupAll();


            var bytotalGroup = cf.total.groupAll().reduceSum(function (d) { return d.Total; });

            var sectorByTotal = cf.sector.group().reduceSum(function (d) { return d.Total; });
            var agencyByTotal = cf.agency.group().reduceSum(function (d) { return d.Total; });
            var areaByTotal = cf.area.group().reduceSum(function (d) { return d.Total; });
            var ccodeByTotal = cf.ccode.group().reduceSum(function (d) { return d.Total; });





            // Implement bookmarking chart filters category --> Thanks to https://github.com/franckalbinet
            // Serializing filters values in URL
            function getFiltersValues() {
                var filters = [
                    { name: 'sector', value: sector_chart.filters()},
                    { name: 'area', value: area_chart.filters()},
                    { name: 'map2', value: map2_chart.filters()},
                    { name: 'org', value: org_chart.filters()}
                    ];
                var recursiveEncoded = $.param( filters );
                location.hash = recursiveEncoded;
            }
            // Init chart filters
            function initFilters() {
                // Get hash values
                var parseHash = /^#sector=([A-Za-z0-9,_\-\/\s]*)&objective=([A-Za-z0-9,_\-\/\s]*)&output=([A-Za-z0-9,_\-\/\s]*)&category=([A-Za-z0-9,_\-\/\s]*)&area=([A-Za-z0-9,_\-\/\s]*)&map2=([A-Za-z0-9,_\-\/\s]*)&org=([A-Za-z0-9,_\-\/\s]*)$/;
                var parsed = parseHash.exec(decodeURIComponent(location.hash));
                function filter(chart, rank) {  // for instance chart = sector_chart and rank in URL hash = 1
                    // sector chart
                    if (parsed[rank] == "") {
                        chart.filter(null);
                    }
                    else {
                        var filterValues = parsed[rank].split(",");
                        for (var i = 0; i < filterValues.length; i++ ) {
                            chart.filter(filterValues[i]);
                        }
                    }
                }
                if (parsed) {
                    filter(sector_chart, 1);
                    filter(objective_chart, 2);
                    filter(output_chart, 3);
                    filter(category_chart, 4);
                    filter(area_chart, 5);
                    filter(map2_chart, 6);
                    filter(org_chart, 7);
                    filter(costunit_chart, 8);
                    filter(gender_chart, 9);
                    filter(target_chart, 10);
                }
            }

            // tooltips for row chart
            var rowTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" +  d.key + "</span> : "  + numberFormat(d.value) + " USD"; });




            dc.dataCount("#count-info")
                .dimension(cf)
                .group(all);



           dc.numberDisplay("#totalusd")
               .formatNumber(d3.format(",f"))
               .valueAccessor(function(d){return +d})
            .group(bytotalGroup);




             /* 3W data are sorted per sector and color are allocated to sectors as per standard code in rrp6 */
            sector_chart.width(400).height(300)
                .dimension(cf.sector)
                .group(sectorByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) {
                    return group.top(15);
                })
                .colors(['#3182bd'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
				.margins({top: 0, right: 55, bottom: -1, left: 30})
                .xAxis().ticks(4).tickFormat(d3.format("s"));


            area_chart.width(400).height(220)
                .dimension(cf.area)
                .group(areaByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) {
                    return group.top(7);
                })
                .colors(['#A9DDA9'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
                .xAxis().ticks(4).tickFormat(d3.format("s"));

            org_chart.width(450).height(570)
                .dimension(cf.agency)
                .group(agencyByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) {
                    return group.top(20);
                })
                .colors(['#3182bd'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
                .xAxis().ticks(4).tickFormat(d3.format("s"));


         /* Region map with ID rid */
            d3.json("data/world.geojson", function (governJSON) {

                 map2_chart.width(350).height(200)
                    .dimension(cf.ccode)
                    .group(ccodeByTotal)
                    .colors(['#FFFFFF', "rgb(49,163,84)"]) //'#CB181D'
                    .colorDomain([0, 2])
                    .overlayGeoJson(governJSON.features, "cname", function (d) {
                        return d.properties.cname;
                    })
                    .projection(d3.geo.mercator().center([58,29]).scale(600)) /* Center on Jordan */
					.title(function (d) {
                        return "Geo-Filter: " + d.key;
                    });

                    $('#reset').on('click', function (){
                      dc.filterAll();
                      dc.redrawAll();
                      return false;
                    })
                    //dc.redrawAll();
                    dc.renderAll();

                    /* Customised infobox */
                    d3.selectAll("g.row").call(rowTip);
                    d3.selectAll("g.row").on('mouseover', rowTip.show)
                        .on('mouseout', rowTip.hide);


                });

            $('#loading').hide();
            $('#dashboard').show();

        });

	function rtip(){
            var numberFormat = d3.format(",f");
            var rowTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" +  d.key + "</span> : "  + numberFormat(d.value) + " USD"; });


	                    d3.selectAll("g.row").call(rowTip);
                    d3.selectAll("g.row").on('mouseover', rowTip.show)
                        .on('mouseout', rowTip.hide);
				}
    </script>
    <script src="js/bootstrap.js"></script>

            <script src="js/bootstrap.js"></script>
            <div class="d3-tip" style="box-sizing: border-box; position: absolute; display: none">&nbsp;</div>
            <div class="d3-tip" style="box-sizing: border-box; position: absolute; display: none">&nbsp;</div>
            <div class="d3-tip" style="box-sizing: border-box; position: absolute; display: none">&nbsp;</div>
        </div>
    </body>
</html>
